<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OrderDAO">

	<!-- 페이징 -->
	<select id="orderTotalCnt" resultType="int">
		SELECT COUNT(*) FROM BC_ORDER WHERE 1=1
	</select>
	
	<select id="adminOrderList" resultType="orderdto">
		SELECT o.*, p.P_DESC, p.P_PRICE, p.P_IMG
		FROM BC_ORDER AS o JOIN BC_PROD as p on o.P_NO = p.P_NO
		ORDER BY O_NO DESC
		LIMIT #{sizePerPage} OFFSET #{startList}
	</select>

	<select id="myOrderList" resultType="orderdto">
		SELECT o.*, p.P_DESC, p.P_PRICE, p.P_IMG
		FROM BC_ORDER AS o JOIN BC_PROD AS p on o.P_NO = p.P_NO where U_NO = #{u_no}
	</select>
	
	<select id="myOrderDetail" resultType="orderdto">
		SELECT o.*, p.P_DESC, p.P_PRICE, p.P_IMG
		FROM BC_ORDER AS o JOIN BC_PROD AS p on o.P_NO = p.P_NO where O_NO = #{o_no}
	</select>
	
	<select id="myRevIstOrder" resultType="orderdto">
		SELECT * FROM BC_ORDER WHERE U_NO = #{u_no} AND O_REVSTATE = 0 AND O_STATE = '배송완료'
	</select>

	<update id="orderRevchk">
		UPDATE BC_ORDER SET O_REVSTATE = 1 WHERE O_NO = #{o_no}
	</update>

	<insert id="insertOrder">
		INSERT INTO BC_ORDER (O_NO, U_NO, U_NAME, P_NO, P_NAME, O_STOCK, O_TOTAL, O_ADDR, U_TEL) 
		VALUES(#{o_no}, #{u_no}, #{u_name}, #{p_no}, #{p_name}, #{o_stock}, #{o_total}, #{o_addr}, #{u_tel})
	</insert>
	
	<delete id="deleteOrder">
		DELETE FROM BC_ORDER WHERE O_NO = #{o_no}
	</delete>
</mapper>
